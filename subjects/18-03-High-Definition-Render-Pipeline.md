# 18.3 High-Definition Render Pipeline (HDRP)

[← Back to Chapter 18](../chapters/18-Scriptable-Render-Pipeline.md) | [Main Index](../README.md)

HDRP is Unity's high-end SRP for AAA graphics on PC and consoles: physically-based lighting, volumetrics, screen-space effects, raytracing, and advanced materials.

---

## Overview

HDRP Target: High-end platforms (PC DirectX 12/Vulkan, PlayStation 4/5, Xbox One/Series X), AAA visual quality (photorealistic rendering, film/archviz), compute shader-heavy (requires modern GPUs, DX11 minimum but DX12+ recommended). Not for: mobile (unsupported, too expensive), Switch (hardware insufficient, use URP), low-end PC (HDRP requires dedicated GPU, integrated graphics insufficient). Best for: cinematic games, architectural visualization, high-fidelity VR (demanding but stunning).

Key Features: Physically-based sky (atmospheric scattering, volumetric clouds, dynamic time-of-day), volumetric fog (lit fog volumes, per-pixel density, light scattering), screen-space effects (SSAO, SSR, SSGI = global illumination in screen space, contact shadows), advanced materials (layered materials, subsurface scattering, clear coat, anisotropy), deferred/forward+ rendering (deferred default for many lights, forward+ for transparency), DXR raytracing (ray-traced reflections, shadows, ambient occlusion, global illumination on RTX GPUs).

Performance Cost: Significantly more expensive than URP/Built-In (2-4x GPU cost, higher memory usage ~50-100MB for G-buffer + volumes). Targets: 30-60 FPS on console/high-end PC (not 120+ FPS lightweight games), 4K viable on PS5/Xbox Series X (HDRP scales well with resolution, deferred rendering benefits). Optimization critical (HDRP features expensive, must profile/optimize carefully, balance quality vs performance).

## Key Concepts

- **HD Render Pipeline Asset**: Settings asset (Project Settings > Graphics > SRP Settings = assign HDRP asset, plus Quality > HDRP = quality-specific assets). Configures: rendering (deferred/forward, MSAA, decals), lighting (shadows, volumetrics, max lights), quality (LOD bias, shadow distances, reflection probe resolution). Multiple assets: Quality levels (Low/Medium/High/Ultra, different shadow/volumetric/reflection settings). Create: Assets > Create > Rendering > HDRP Asset, or use HDRP Wizard (Window > Rendering > HDRP Wizard, setup project automatically).
- **Physically-Based Sky**: Atmospheric scattering simulation (Rayleigh scattering for sky color, Mie scattering for haze, Ozone absorption). Setup: Volume component (Sky > Physically Based Sky, configure: planet radius, air/aerosol density, ground tint). Lighting: Directional light (acts as sun, intensity/color affects sky), updates automatically (sky color/brightness matches light direction/intensity). Dynamic time-of-day: animate directional light rotation (sky transitions dawn → day → dusk → night, automatic color shifts). Benefits: photorealistic outdoor lighting (sky matches environment, consistent lighting), no skybox textures (procedural, zero memory cost).
- **Volumetric Fog**: 3D fog with lighting (fog lit by lights, casts volumetric shadows, light shafts/god rays). Setup: Volume component (Fog > Volumetric Fog, enable, configure: base fog height, max distance, anisotropy). Local volumes (Density Volume = 3D texture defines fog density per voxel, artists paint fog regions). Lighting: lights affect fog (point/spot lights create volumetric cones, directional light creates shafts through fog). Performance: expensive (voxel-based, resolution configurable in HDRP asset: 64/128/256, higher = better quality + slower, typical cost 2-5ms on PC). Mobile/Switch: not viable (too expensive, disable volumetrics).
- **Screen-Space Global Illumination (SSGI)**: Approximates GI in screen space (reads depth/normal/color buffers, traces rays in screen space, estimates indirect lighting). Benefits: dynamic GI (no baking, works with moving objects), real-time updates (lighting changes immediately). Limitations: screen-space only (only visible surfaces contribute, off-screen geometry ignored), noisy (ray tracing limited samples, denoising required). Performance: expensive (4-10ms on PC, requires powerful GPU, RTX GPUs faster with RT cores). Setup: Volume component (Lighting > Screen Space Global Illumination, enable, configure: ray samples, denoiser quality). Best for: indoor scenes (walls/ceilings visible on screen, GI bounces visible), architectural viz (dynamic lighting critical).
- **Ray Tracing**: Hardware-accelerated ray tracing (DXR on RTX GPUs, PS5 hardware RT, Xbox Series X DXR). Features: RT Reflections (ray-traced reflections, accurate mirrors/glossy surfaces), RT Shadows (sharp contact shadows, soft area shadows), RT Ambient Occlusion (accurate occlusion in corners/crevices), RT Global Illumination (full ray-traced GI, most expensive). Requirements: RTX 20-series+ GPU (or AMD RX 6000+, or PS5/Xbox Series X), DX12/Vulkan. Performance: very expensive (RT Reflections = 5-15ms, RT GI = 20-50ms, only viable on high-end). Setup: HDRP asset > enable Ray Tracing, Volume components (Ray-Traced Reflections, Ray-Traced Shadows, etc., enable per effect). Quality modes (Performance/Quality, adjust ray counts/denoising).
- **Lit Shader (HDRP)**: Advanced PBR material (base color, normal, metallic, smoothness, plus: coat mask for clear coat, anisotropy for brushed metal, subsurface scattering for skin/wax). Material Types: Standard (default PBR), Subsurface Scattering (translucency, light penetrates surface, used for skin/foliage), Anisotropic (directional specular, brushed metal), Iridescence (thin-film interference, soap bubbles), Translucent (light passes through, stained glass). Layered materials: blend multiple materials (e.g., base metal + rust layer + scratches, mask controls blending). Decals: project textures onto surfaces (bullet holes, graffiti, wet patches). Shader Graph: HDRP Lit/Unlit master stacks (create custom materials visually).

## Best Practices

**HDRP Project Setup:**
- New project: Unity Hub > HDRP Template (pre-configured HDRP project, sample scenes, shaders, post-processing). Or: create empty project, install HDRP package (Window > Package Manager > High Definition RP, install), run HDRP Wizard (Window > Rendering > HDRP Wizard, click "Fix All" to configure project: assign HDRP asset, convert scene settings, upgrade materials).
- Existing project upgrade: Challenging (Built-In/URP to HDRP = significant changes, shaders completely different, performance characteristics change). Best: start new HDRP project, migrate assets incrementally (export from old project, import to HDRP, update materials/lighting). Automatic upgrade: Edit > Render Pipeline > HD > Upgrade Project Materials to HDRP (converts materials, limited success, manual fixes required).
- Hardware requirements: Document minimum specs (RTX 2060 or equivalent for RT features, GTX 1060 minimum for non-RT HDRP), test on target hardware (performance varies widely, console optimization critical), provide quality settings (Low/Medium/High presets, users scale features).

**Lighting Setup:**
- Physically-Based Sky: Add Volume (GameObject > Volume > Global Volume), add Sky override (Volume Profile > Add Override > Sky > Physically Based Sky), configure (planet radius 6378 km = Earth-like, air scattering default values, ground tint = terrain color). Directional light (acts as sun, intensity 100,000-130,000 lux = daylight, rotate for time-of-day). Baking: sky contributes to lightmaps (baked GI uses sky for ambient, ensure sky enabled during baking).
- Volumetric Fog: Add Fog override (Volume Profile > Add Override > Fog > Fog, enable Volumetric Fog), configure (Base Height = 0-50m fog layer, Max Distance = 200m, Anisotropy = 0.5 forward scattering). Local volumes (create Density Volume: GameObject > Rendering > Density Volume, paint fog in 3D texture, blend into scene fog). Lights (enable Volumetric in Light component, point/spot lights create visible cones in fog). Performance: reduce volumetric resolution (HDRP asset > Lighting > Volumetrics > Resolution = 64 for Low, 128 for Medium, 256 for High), shorter max distance (fog beyond 100m less important, reduces voxel count).
- Reflection Probes: Place probes (GameObject > Light > Reflection Probe, position in rooms/areas), bake (Lighting window > Generate Lighting, bakes cubemaps), or realtime (Probe > Mode = Realtime, expensive = updates every frame). HDRP: higher-resolution probes (512/1024/2048 vs Built-In's 128/256, better quality), planar probes (for mirrors, perfect reflections, very expensive = 2-5ms per probe). Use sparingly (baked probes preferred, realtime only for critical reflections).
- Screen-Space Effects: Enable in Volume (SSAO, SSR, SSGI overrides), configure quality (ray samples, denoising). SSAO: cheap (1-2ms, ambient occlusion in crevices), enable always. SSR: moderate (2-5ms, screen-space reflections, less accurate than RT but viable). SSGI: expensive (5-10ms, dynamic GI, use if baked GI insufficient). Balance (SSAO + SSR = good baseline, add SSGI if budget allows, skip for 60+ FPS targets).

**Material Authoring:**
- Lit Shader: Standard PBR workflow (base color texture, normal map, mask map = metallic/AO/detail/smoothness packed in single texture). HDRP mask packing (Red = Metallic, Green = Occlusion, Blue = Detail mask, Alpha = Smoothness), saves texture slots (4 maps in one). DCC tools (export mask maps from Substance, Blender, or pack manually in Photoshop). Coat Mask (for clear coat materials: car paint, wet surfaces, adds second specular layer, grayscale mask controls intensity).
- Subsurface Scattering (SSS): Enable in Material (Material > Surface Type = Subsurface Scattering), configure (Diffusion Profile = Skin/Foliage preset, or custom, Subsurface Mask = grayscale texture controls SSS intensity). Use cases: character skin (light penetrates ears, nose, creates soft translucency), foliage (leaves glow when backlit). Cost: moderate (additional lighting pass, 10-20% overhead), use selectively (characters/hero assets only, not all objects).
- Layered Materials: Blend multiple material layers (e.g., Layer 0 = base rock, Layer 1 = moss, Layer 2 = snow). Setup: Material > Material Type = LayeredLit, add layers (Layer 0/1/2/3, each has own textures), mask textures (grayscale masks control layer blending, vertex colors or textures). Use: terrain blending (rock to grass transition), weathering (clean metal base + rust layer + dirt), complex surfaces (one material instead of multiple decals). Cost: expensive (multiple texture samples per layer, limit to 2-3 layers, avoid on all objects).
- Decals: Project textures onto geometry (bullet holes, puddles, graffiti). Setup: create Decal Projector (GameObject > Rendering > Decal Projector), assign decal material (Material > Shader = HDRP/Decal), set projector bounds (box projects decal onto surfaces inside). Decal material (texture + blend mode: Albedo, Normal, or Emissive, masked to shape). Atlasing (combine decals into texture atlas, reduce draw calls, HDRP supports decal clustering = efficient many decals).

**Ray Tracing Integration:**
- Enable RT in project: HDRP asset > enable Realtime Ray Tracing, Player Settings > Other > Scripting Backend = IL2CPP (required for DXR). Validate hardware (RTX GPU or console with RT support).
- RT Reflections: Volume > Add Override > Ray-Traced Reflections (replaces SSR), configure (Ray Length = max trace distance, Sample Count = samples per pixel, denoise). Quality modes (Performance = 1 sample + aggressive denoise, Quality = 4 samples + light denoise). Objects: all opaque objects reflect by default (disable per-object: Mesh Renderer > Ray Tracing Mode = Off).
- RT Shadows: Per-Light setting (Directional/Point/Spot Light > Shadows > Enable Ray-Traced Shadows), better quality (sharp contact shadows, smooth penumbra for area lights), expensive (3-5ms per RT shadow light, limit to 1-2 key lights). Use: hero character shadows (sharp contact shadows on face, high quality), or main environment light (RT sun shadows for realistic outdoor lighting).
- RT Global Illumination: Volume > Add Override > Ray-Traced Global Illumination (replaces baked GI + Light Probes), most expensive RT feature (20-50ms, full path tracing). Use cases: architectural viz (fully dynamic lighting, no baking), cinematic scenes (ultimate quality, 30 FPS acceptable). Performance: reduce samples (1-2 samples + heavy denoise = noisy but fast), limit bounces (1-2 bounces sufficient, more = diminishing returns). Not viable for real-time games (too expensive, use baked GI + SSGI instead).

**Performance Optimization:**
- Quality presets: Create Low/Medium/High HDRP assets (Low = no volumetrics, low shadows, no RT, Medium = volumetrics 64res, medium shadows, SSR only, High = volumetrics 128res, high shadows, RT reflections + shadows). Assign per quality level (Quality Settings > Levels > HDRP Asset per level).
- Reduce volumetric resolution: HDRP asset > Lighting > Volumetrics > Resolution = 64 (Low, 2-3x faster than 128), Max Distance = 100m (shorter range = fewer voxels). Disable on distant cameras (reflection cameras, shadow cameras don't need volumetrics).
- Shadow optimization: Reduce shadow distance (Volume > Shadows > Max Distance = 50-100m), lower cascade count (4 cascades = high quality + expensive, 2 cascades = acceptable + faster), shadow resolution (High = 4096 for main light, Medium = 2048, Low = 1024). Additional lights (limit shadow-casting additional lights, HDRP asset > Lighting > Max Punctual Light Shadow-Casting = 4).
- Screen-space settings: Reduce ray samples (SSGI > Ray Steps = 16 Low, 32 Medium, 64 High), aggressive denoising (denoise quality = Low for performance, High for quality). Disable expensive effects (SSGI off for 60 FPS targets, SSR only, skip volumetrics on low-end).

**Platform-Specific:**
- **PC**: Full HDRP (all features viable, volumetrics, SSGI, RT on RTX GPUs), multiple quality presets (Low for GTX 1060, High for RTX 3080). RT recommended for RTX 30-series+ (RT Reflections + Shadows viable at 60 FPS, RT GI too expensive for realtime). Target: 30-60 FPS (HDRP intensive, 120 FPS difficult, optimize aggressively for 60). Resolution: 1080p baseline, 1440p high-end, 4K ultra (DLSS helps on RTX, upscaling from 1080p to 4K).
- **Consoles**: PS5/Xbox Series X viable (HDRP supported, hardware RT available, 30-60 FPS targets). Settings: Medium/High presets (volumetrics 64-128, shadows 1024-2048, RT reflections possible but expensive = 30 FPS). PS4/Xbox One: not recommended (hardware insufficient, if required use Low settings = essentially URP-level quality, prefer URP instead). Memory: watch G-buffer + volumetrics (50-100MB overhead, budget carefully on console's unified memory).
- **Switch**: Not supported (hardware incompatible, HDRP requires modern GPU features Switch lacks). Use URP instead (HDRP too expensive even at lowest settings).
- **Mobile**: Not supported (HDRP designed for desktop/console, mobile GPUs insufficient). Use URP (mobile-optimized, tile-based rendering benefits, URP essential for mobile viability).

## Common Pitfalls

**Ray Tracing Without RT Hardware**: Developer enables RT features (RT Reflections, RT GI), tests on non-RTX GPU (GTX 1080, or AMD pre-RX 6000). Performance collapses (RT falls back to compute shader emulation, 10-50x slower than RTX, single-digit FPS). Symptom: Game unplayable (<10 FPS), GPU Profiler shows RT passes taking 100+ ms. Solution: Detect hardware (check SystemInfo.supportsRayTracing), disable RT on non-RTX (fallback to SSR, baked GI), or require RTX minimum specs (document requirements, refuse to launch on incompatible hardware).

**Volumetric Fog Resolution Too High**: Developer sets volumetric resolution to 256 (thinking higher = better), performance tanks (volumetric lighting = expensive per voxel, 256³ = millions of voxels). Symptom: GPU bottleneck (Profiler shows Volumetric Lighting pass 10-20ms), lower than expected frame rate. Solution: Reduce resolution (128 = good quality, 64 = acceptable on console/lower-end, 256 = only for ultra settings on RTX 4080+), shorter max distance (200m max = fewer voxels than 500m), disable volumetrics on low quality (Low preset = no volumetrics, fog uses exponential model instead).

**SSGI Everywhere**: Developer enables SSGI globally (thinking dynamic GI essential), frame rate drops to 30 FPS (SSGI expensive, 5-10ms overhead, breaks 60 FPS budget). Symptom: GPU bottleneck (Profiler shows SSGI pass expensive), marginal visual difference (baked GI + Light Probes often sufficient, SSGI subtle improvement). Solution: Use baked GI for static geometry (Lighting window > Generate Lighting, bakes lightmaps + Light Probes), SSGI only for dynamic objects (local Volume around dynamic areas, enable SSGI, static areas use baked), or disable SSGI (SSR + baked GI sufficient for most games, SSGI for archviz/cinematics only).

**Layered Materials on Everything**: Artist creates layered materials for all surfaces (thinking blending necessary), texture memory explodes (layered material = 4 layers × 5 textures per layer = 20 textures per material, gigabytes of textures). Symptom: High memory usage (Profiler shows textures dominating memory), long load times (loading many textures), frame hitches (texture streaming thrashing). Solution: Layered materials sparingly (terrain blending, hero assets only, not every object), regular Lit shader for simple surfaces (single layer = 3-5 textures, sufficient for most materials), or reduce layer count (2 layers instead of 4, still allows blending but half the texture cost).

## Tools & Workflow

**HDRP Wizard**: Window > Rendering > HDRP Wizard (opens setup wizard). Checks: color space (Linear required), static batching (disabled, incompatible with SRP Batcher), DXR resources (assigned for ray tracing). Actions: Fix All (automatically configures project for HDRP, assigns default HDRP asset, upgrades scene settings), Install Sample Scenes (installs HDRP sample scenes, useful for learning). Run after installing HDRP package (ensures project configured correctly).

**HDRP Asset Creation**: Assets > Create > Rendering > HD Render Pipeline > Render Pipeline Asset (creates HDRenderPipelineAsset + HDRenderPipelineGlobalSettings). Configure: select asset, Inspector shows settings (Rendering, Lighting, Material, Post-processing, XR, Quality), create multiple assets for quality levels (Low/Medium/High, different shadow/volumetric/RT settings). Assign: Project Settings > Graphics > Scriptable Render Pipeline Settings = HDRP asset, Quality > HDRP = quality-specific assets.

**Volume Profiles**: Assets > Create > Volume Profile (creates profile asset for HDRP overrides). Add overrides: select profile, Inspector > Add Override (Sky, Fog, Exposure, Bloom, Color Adjustments, etc.), configure per override. Apply: create GameObject with Volume component (GameObject > Volume > Global Volume or Box/Sphere Volume), assign profile. Global volumes affect all cameras, local volumes (Box/Sphere/Convex Mesh) affect camera when inside volume bounds (blend distance configures fade).

**Look Dev Tool**: Window > Rendering > Look Dev (HDRI environment for material authoring). Drag material: shows material on test geometry (sphere, cylinder, cloth), rotate HDRI (see material under different lighting), compare (split view shows two materials side-by-side). Usage: author PBR materials (validate metallic/smoothness values, ensure physically plausible), iterate quickly (real-time preview, no scene setup required), test lighting (switch HDRIs, see material in daylight/studio/outdoor).

**Material Upgrade Tool**: Edit > Render Pipeline > HD Render Pipeline > Upgrade from Built-in Pipeline > Upgrade Project Materials to HDRP. Scans project (finds Built-In materials), converts (Standard → HDRP/Lit, Standard Specular → HDRP/Lit Specular, Unlit → HDRP/Unlit). Partially successful (simple materials convert well, complex/custom shaders require manual porting). Backup first (commit to version control, or File > Save Project before upgrading).

**HDRP Debugger**: Window > Analysis > Rendering Debugger (HDRP-specific overlays). Modes: Material (visualize albedo, metallic, smoothness, normal, lighting complexity), Lighting (diffuse only, specular only, light counts, volumetrics), Rendering (overdraw, mipmap levels, motion vectors, quad overdraw). Usage: identify issues (HDRP Debug > Material > Validation Mode = highlights materials with out-of-range albedo/metallic), profile (Lighting > Show Light Volumes = visualizes light culling, pixel overdraw from volumetrics).

## Related Topics

- [18.1 SRP Architecture](18-01-SRP-Architecture.md) - SRP fundamentals
- [18.2 Universal Render Pipeline](18-02-Universal-Render-Pipeline.md) - URP comparison
- [13.1 Lighting Fundamentals](13-01-Lighting-Fundamentals.md) - Lighting basics
- [13.3 Post-Processing](13-03-Post-Processing.md) - Post-processing stack

---

[← Previous: 18.2 Universal Render Pipeline](18-02-Universal-Render-Pipeline.md) | [Next: 18.4 Built-In Render Pipeline →](18-04-Built-In-Render-Pipeline.md)
